let t;var e=globalThis,i={},s={},n=e.parcelRequireaac9;null==n&&((n=function(t){if(t in i)return i[t].exports;if(t in s){var e=s[t];delete s[t];var n={id:t,exports:{}};return i[t]=n,e.call(n.exports,n,n.exports),n.exports}var o=Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(t,e){s[t]=e},e.parcelRequireaac9=n);var o=n.register;o("27Lyk",function(t,e){Object.defineProperty(t.exports,"register",{get:()=>i,set:t=>i=t,enumerable:!0,configurable:!0});var i,s=new Map;i=function(t,e){for(var i=0;i<e.length-1;i+=2)s.set(e[i],{baseUrl:t,path:e[i+1]})}}),o("hjoG2",function(t,e){t.exports=new URL("darkgueb.1d21d955.png",import.meta.url).toString()}),o("axFK2",function(t,e){t.exports=new URL("logo.82e9728c.png",import.meta.url).toString()}),n("27Lyk").register(new URL("",import.meta.url).toString(),JSON.parse('["jCdZq","index.9e6b0a88.js","9sDUa","darkgueb.1d21d955.png","aYQdk","logo.82e9728c.png"]'));const a={leftKey:65,upKey:87,rightKey:68,downKey:83,aKey:"K".charCodeAt(),bKey:"J".charCodeAt()},r={C0:16.35,Db0:17.32,D0:18.35,Eb0:19.45,E0:20.6,F0:21.83,Gb0:23.12,G0:24.5,Ab0:25.96,A0:27.5,Bb0:29.14,B0:30.87,C1:32.7,Db1:34.65,D1:36.71,Eb1:38.89,E1:41.2,F1:43.65,Gb1:46.25,G1:49,Ab1:51.91,A1:55,Bb1:58.27,B1:61.74,C2:65.41,Db2:69.3,D2:73.42,Eb2:77.78,E2:82.41,F2:87.31,Gb2:92.5,G2:98,Ab2:103.83,A2:110,Bb2:116.54,B2:123.47,C3:130.81,Db3:138.59,D3:146.83,Eb3:155.56,E3:164.81,F3:174.61,Gb3:185,G3:196,Ab3:207.65,A3:220,Bb3:233.08,B3:246.94,C4:261.63,Db4:277.18,D4:293.66,Eb4:311.13,E4:329.63,F4:349.23,Gb4:369.99,G4:392,Ab4:415.3,A4:440,Bb4:466.16,B4:493.88,C5:523.25,Db5:554.37,D5:587.33,Eb5:622.25,E5:659.25,F5:698.46,Gb5:739.99,G5:783.99,Ab5:830.61,A5:880,Bb5:932.33,B5:987.77,C6:1046.5,Db6:1108.73,D6:1174.66,Eb6:1244.51,E6:1318.51,F6:1396.91,Gb6:1479.98,G6:1567.98,Ab6:1661.22,A6:1760,Bb6:1864.66,B6:1975.53,C7:2093,Db7:2217.46,D7:2349.32,Eb7:2489.02,E7:2637.02,F7:2793.83,Gb7:2959.96,G7:3135.96,Ab7:3322.44,A7:3520,Bb7:3729.31,B7:3951.07,C8:4186.01,Db8:4434.92,D8:4698.63,Eb8:4978.03,E8:5274.04,F8:5587.65,Gb8:5919.91,G8:6271.93,Ab8:6644.88,A8:7040,Bb8:7458.62,B8:7902.13},l=e=>{t=new(window.AudioContext||window.webkitAudioContext||window.audioContext)},h=(e,i,s,n,o=!1)=>{let a=e/1e3,r=t.createOscillator(),l=t.createGain();l.connect(t.destination),l.gain.setValueAtTime(0,0),l.gain.linearRampToValueAtTime(n,t.currentTime+.01*a),l.gain.setValueAtTime(n,t.currentTime+a-.4*a),l.gain.linearRampToValueAtTime(0,t.currentTime+a),r.type=s,r.frequency.setValueAtTime(i,0),o&&r.frequency.linearRampToValueAtTime(o,t.currentTime+a),r.start(0),r.stop(t.currentTime+a),r.connect(l)},c=([t,...e],i=.1,s="triangle")=>{if(!t)return;let[n,o]=t;h(n,o,s,i);let a=setTimeout(()=>{clearTimeout(a),c(e,i,s)},n)},p=(t,e)=>t.map((t,i)=>[e[i],r[t]||0]),d=t=>{c(p(["Fb2","F2","Gb2","G2","Ab2","A2","Bb2","B2","Bb2","C3","Db3","D3"],[40,160,40,160,40,160,40,160,40,160,40,160]),.1,"square")},g=t=>{t.gameOver||(h(1500,523.25,"triangle",.1,880),setTimeout(()=>{g(t)},1500))},u=document.getElementById("background").getContext("2d"),f=(t,e)=>{u.fillStyle=R.palette[1],u.textAlign="left",u.fillText(t,50,e)},m=(t,e)=>{u.fillStyle=R.palette[5],0>parseInt(t,10)&&(u.fillStyle=R.palette[4]),u.textAlign="right",u.fillText(`$${t}`,450,e)},y=t=>{let e;let i=JSON.parse(JSON.stringify(R.brain.get("loot")));tx(),u.font='14px "Press Start 2P"';let s=T.instances.filter(t=>!t.playerScaped||t.freezed).map(t=>["Enterpreneur caught",-2e3]),n=[["Incoming balance",R.brain.get("balance")],...i,["Daily expenses",-52],...s].map(([t,i],s)=>(e=s,f(t,100+25*s),m(i,100+25*s),i)).reduce((t,e)=>t+e);f("Total",100+(e+3)*25),m(n,100+(e+3)*25),u.fillStyle=R.palette[1],n<0&&(u.textAlign="left",u.fillText('Your "carreer" is over',50,400)),R.brain.set("balance",Math.max(0,n)),setTimeout(()=>{u.textAlign="left",u.fillText("[> Go back",50,450),t.changeTrigger(b(t))},2e3)};let x=-1/0;const b=t=>e=>{new Date().getTime()-x<60||(x=new Date().getTime(),S(e,t))},S=(t,e)=>{t===a.leftKey&&tp(e)},w=document.getElementById("vfx").getContext("2d");class T{constructor(t,e,i,s=!1){this.position={x:e,y:i,flip:!0,inside:!1,col:{x:8,y:32,w:16,h:16}},this.stance="standing",this.active=s,this.ctx=t,this.playerScaped=!1,this.freezed=!1,this.properties={foundMessage:"Intruder found!"},this.x=e,this.y=i,this.clearText=()=>T.clearText(this),T.instances||(T.instances=[]),T.instances.push(this)}static create(...t){return new T(...t)}static getCurrent(){return T.instances.find(t=>t.active)}static clearText(t){if(t.textBound){let e=t.textBound;w.clearRect(e.x-1,e.y-1,e.w+2,e.h+2)}}setBound(){this.bound={x:this.position.x+this.position.col.x,y:this.position.y+this.position.col.y,w:this.position.col.w,h:this.position.col.h}}toggleActivation(){if(this.active=!this.active,this.playerScaped||(this.draw(),!this.active))return;let t=this.position.flip?16:12;this.ctx.beginPath(),this.ctx.rect(this.position.x+t,this.position.y+24,4,4),this.ctx.fillStyle=R.palette[1],this.ctx.fill(),this.ctx.closePath()}return(){if(!this.playerScaped)return;this.playerScaped=!1;let{x:t,y:e}=this;e<20&&(this.y=20),t<100&&(this.x=100),t>400&&(this.x=400),R.displayText("Returned",this),setTimeout(()=>{this.clearText()},1e3)}scaped(t,e){return -24!==t&&504!==t&&-32!==e&&480!==e||(w.fillStyle=R.palette[1],e<20&&(this.y=20),t<100&&(this.x=100),t>400&&(this.x=400),R.displayText("Escaped",this),setTimeout(()=>{this.clearText()},1e3),this.playerScaped=!0,T.instances.forEach(t=>t.toggleActivation()),this.ctx.clearRect(0,0,512,512),T.instances.some(t=>!t.playerScaped)||(R.gameOver=!0,clearInterval(R.timer),y(R.user))),this.playerScaped}move({x:t=this.position.x,y:e=this.position.y},i=!1){if(R.gameOver||this.playerScaped||this.freezed)return;if(this.movement="up",t-this.position.x>0&&(this.movement="right"),t-this.position.x<0&&(this.movement="left"),e-this.position.y>0&&(this.movement="down"),this.setBound(),this.interactingWith&&this.interactingWith.properties.constraints){let{x:t,y:e}=this.interactingWith,i=this.position.x+8,s=this.position.col.y+this.position.y,n="up";if(t<i?n="left":t>i?n="right":e>s&&(n="down"),!this.interactingWith.properties.constraints.includes(this.movement))return this.interactingWith.changeConditions();if("up"===n&&"down"===this.movement||"down"===n&&"up"===this.movement){this.interactingWith.reset(),this.stance="standing",this.draw(),this.interactingWith.draw(),delete this.interactingWith;return}}delete this.interactingWith;let s=R.computePosition(t,e+16);!i&&(this.scaped(t,e)||s.x<1||s.x>32||s.y<2||s.y>32||E.activateObject(t,e)||0!==R.collitionMap[s.collitionIndex])||(this.position.x=t,this.position.y=e,this.x=t,this.y=e,this.width=this.bound.w,R.testTrigger(s.collitionIndex,this),R.testHalt(s.collitionIndex),this.draw())}draw(){this.setBound();let{collitionIndex:t}=R.computePosition(this.position.x,this.position.y);this.position.inside=0!==R.insideMap[t],this.ctx.beginPath(),this.ctx.clearRect(0,0,512,512);let e=32,i=48,s={x:0,y:0},[n,o]={"false,false":[64,80],"true,false":[32,80],"true,true":[32,128],"false,true":[64,128]}[[this.position.flip,this.position.inside].join(",")];"kneeled"===this.stance&&(e=32,i=32,n=0,o=96,this.position.inside&&(o=144),s={x:4,y:8}),this.ctx.drawImage(W,n,o,e,i,this.position.x+s.x,this.position.y+s.y,e,i),k&&(this.ctx.rect(this.bound.x,this.bound.y,this.bound.w,this.bound.h),this.ctx.strokeStyle=R.palette[1],this.ctx.stroke()),this.ctx.closePath(),R.setSight()}}const v=document.getElementById("vfx").getContext("2d");class E{constructor(t){this.ctx=document.getElementById("objects").getContext("2d"),Object.entries(t).forEach(([t,e])=>{this[t]=JSON.parse(JSON.stringify(e))});let e=this.properties;this.state=!!this.state,this.combinationStep=0,this.combinationTicks=0,this.combinationFailed=!1,this.combinationSuccess=!1,this.clearText=()=>E.clearText(this),this.col={x:this.x+e.col.x,y:this.y+e.col.y,w:e.col.w,h:e.col.h},this.collitionIndex=R.computePosition(this.col.x,this.col.y).collitionIndex-1}static setPrototypes(t){E.prototypes=t.filter(({type:t})=>"prototype"===t)}static clearText(t){if(t.textBound){let e=t.textBound;v.clearRect(e.x-1,e.y-1,e.w+2,e.h+2)}}static setObjects(t){t.filter(({type:t})=>"prototype"!==t).forEach(t=>{E.addObject(t)})}static addObject(t){if(t.properties||(t.properties={}),Array.isArray(t.properties)){let e={};t.properties.forEach(({name:t,value:i})=>{e[t]=i}),t.properties=e}E.prototypes.find(e=>e.name===t.type).properties.forEach(({name:e,value:i})=>{t.properties[e]=JSON.parse(i)});let e=new E(t);return E.instances||(E.instances=[]),E.instances.push(e),e.draw(),e}static returnCollition(t,e,i){let s=t+i.bound.w,n=e+i.bound.h;return E.instances.find(i=>{let o=i.col.x,a=i.col.x+i.col.w,r=i.col.y,l=i.col.y+i.col.h;return t<a&&s>o&&e<l&&n>r})}static activateObject(t,e){let i=T.getCurrent(),s=t+i.position.col.x,n=e+i.position.col.y,o=E.returnCollition(s,n,i);if(!o)return!1;if(o.properties.restrictFrom?.includes(i.movement))return;let a={x:32,y:0};return(s<i.position.x+8&&(a.x=-32),n<i.position.y+32&&(a={x:0,y:-48}),n>i.position.y+32&&(a={x:0,y:48}),i.interactingWith=o,!0===o.state&&(o.properties.gateway&&i.move({x:i.position.x+a.x,y:i.position.y+a.y},!0),o.properties.returnState))?(o.setState(!1),o.draw(),!1):(o.properties.interactive&&(i.stance="kneeled",i.draw()),o.properties.changeConditions)?o.changeConditions():(o.state||o.setState(!0),o.draw(),!1)}draw(){"door"===this.type&&R.toggleVisibility(this);let t=this.properties;if(this.ctx.clearRect(this.x,this.y,this.width,this.height),"camera"===this.type){let e=this.state?"":"Alt";t[this.state]=this[`${this.direction}${e}`]}this.ctx.drawImage(W,t[this.state].x,t[this.state].y,this.width,this.height,this.x,this.y,this.width,this.height),"statue"===this.type&&this.statue(),k&&(this.ctx.rect(this.col.x,this.col.y,this.col.w,this.col.h),this.ctx.stroke())}setState(t){"fuse"===this.type&&(R.hasEnergy=!t),!this.state&&t&&["computer","safe","statue"].includes(this.type)&&this.success(),this.state=t,R.triggerSight()}changeConditions(){this[this.type]&&this[this.type]()}success(){let t={computer:[["Cat Pictures",1],["Blackmail evidence",1e3],["Confidential documents",2e3]],safe:[["Some cash",500],["Good cash",1e3],["Very good cash",1500],["Confidential documents",2e3],["Diamonds",3e3]],statue:[["Valuable statue",100],["Limited edition figure",300],["Action figure",70],["Collectable toy",80]]}[this.type];R.brain.loot||R.brain.set("loot",[]);let e=t[~~(t.length*Math.random()|0)];R.brain.push("loot",e)}reset(){this.properties.returnState&&(this.setState(!1),this.draw()),("safe"===this.type||"computer"===this.type)&&(this.combinationStep=0,this.combinationTicks=0,this.combinationFailed=!1,this.booting=!1,this.clearText(),v.clearRect(this.x+8,this.y+4,16,8),"computer"===this.type&&(c(p(["E4","G3"],[60,100]),.4),this.bootingTime&&clearTimeout(this.bootingTime)))}computer(){let t=t=>{let e=["left","up","right"],i=t;for(;i===t;)i=e[Math.floor(Math.random()*e.length)];return i};if(!this.combination){this.combination=[];let e=null;for(let i=0;i<=10;i++){let i=t(e);this.combination.push(i),e=i}}if(this.booting)return;if(0===this.combinationStep){this.booting=!0,this.computerDisplay(),c(p(["G3","E4"],[60,100]),.4),this.bootingTime=setTimeout(()=>{this.combinationStep+=1,this.computerDisplay(),this.booting=!1},1e3);return}let e=T.getCurrent(),i=this.combination[this.combinationStep];if(!i){this.combinationSuccess=!0,this.computerDisplay(),v.fillStyle=R.palette[1],R.displayText("Computer hacked",this),this.setState(!0);return}if(!this.combinationSuccess&&!this.combinationFailed){if(i===e.movement){if(this.combinationStep+=1,!this.combination[this.combinationStep])return this.computer()}else this.combinationFailed=!0;this.computerDisplay()}}statue(){let t=this.properties,e=t[t.variant];this.ctx.clearRect(this.x+4,this.y-4,e.w,e.h),this.state||this.ctx.drawImage(W,e.x,e.y,e.w,e.h,this.x+4,this.y-4,e.w,e.h)}safe(){if(this.combinationFailed)return;if(this.combination||(this.combination=[...Array(Math.round(4*Math.random()+5))].map(t=>Math.round(5*Math.random())+1),this.combination[1]=Math.max(2,this.combination[1])),0===this.combinationStep){this.combinationStep+=1;return}let t=["left","right"][this.combinationStep%2],e=T.getCurrent();if("up"===e.movement&&this.combinationSuccess&&1!==this.combinationStep){this.setState(!0),this.draw();return}if(!this.combinationSuccess||!this.state){if(t===e.movement)this.combinationTicks+=1,A(this.combination,this.combinationStep,this);else{this.combinationFailed=!0,this.combinationSuccess=!1,A(this.combination,this.combinationStep,this),c(p(["E4","","A3"],[60,200,250]),.4);return}this.combination[this.combinationStep]-this.combinationTicks==0?(this.combinationStep+=1,this.combinationTicks=0,A(this.combination,this.combinationStep,this),this.combination[this.combinationStep]&&c(p(["A3"],[60]),.4)):c(p(["A2"],[60]),.4),this.combination[this.combinationStep]||(this.combinationSuccess=!0,A(this.combination,this.combinationStep,this),c(p(["G5"," ","A5"],[50,50,50]),.4))}}computerDisplay(){if(v.clearRect(this.x+8,this.y+4,16,8),v.beginPath(),0===this.combinationStep?v.fillStyle=R.palette[3]:this.combinationFailed?v.fillStyle=R.palette[4]:this.combinationSuccess?v.fillStyle=R.palette[5]:v.fillStyle=R.palette[3],v.rect(this.x+8,this.y+4,16,8),v.fill(),v.closePath(),0===this.combinationStep||this.combinationFailed||this.combinationSuccess)return;v.beginPath(),v.fillStyle=R.palette[5];let t={up:[this.x+12,this.y+4,8,4],left:[this.x+8,this.y+4,4,8],right:[this.x+20,this.y+4,4,8]}[this.combination[this.combinationStep]];v.rect(...t),v.fill(),v.closePath()}}const A=(t,e,i)=>{let s=Array(t.length-1).fill("");s=s.map((i,s)=>s===e-1?"[*]":s>=e-1?"":`[${t[s+1]}]`).filter(t=>""!==t).join(""),v.fillStyle=R.palette[1],i.combinationSuccess&&(v.fillStyle=R.palette[1],s="Safe unlocked"),i.combinationFailed&&(v.fillStyle=R.palette[4]),R.displayText(s,i)},P=document.getElementById("vfx").getContext("2d");class M{constructor(t){this.props=t,this.position={x:t.x,y:t.y},this.canMove=!0,this.width=this.props.width,this.clearText=()=>M.clearText(this),M.instances||(M.instances=[]),M.instances.push(this)}static ctx=document.getElementById("vigilance").getContext("2d");static ctxSight=document.getElementById("light").getContext("2d");static clearText(t){if(t.textBound){let e=t.textBound;P.clearRect(e.x-1,e.y-1,e.w+2,e.h+2)}}static getCamera(t){return M.instances.find(e=>e.id===t)}static getActiveVigilance(){return M.instances.filter(t=>t.props.start).filter(t=>"camera"===t.props.type&&!!R.hasEnergy||"camera"!==t.props.type)}static getAll(){return M.instances}static createAll(t){M.chain=JSON.parse(JSON.stringify(t)).map((t,e,i)=>{let s=t.properties.find(t=>"next"===t.name);if(!s)return t;t.next=s.value,delete t.properties,delete t.name,delete t.rotation,delete t.type,delete t.visible;let n=i.find(t=>t.id===s.value),o="up";return t.x<n.x&&(o="right"),t.x>n.x&&(o="left"),t.y<n.y&&(o="down"),t.direction=o,t}),t.map(t=>{let e=t.properties.find(t=>"start"===t.name);return e?t.start=e.value:t.start=!1,"camera"===t.type&&(t.start=!0),t}).filter(t=>"guard"!==t.type||!!t.start).map(t=>(E.prototypes.find(e=>e.name===t.type).properties.forEach(({name:e,value:i})=>{t[e]=JSON.parse(i)}),t)).forEach(t=>{if("camera"===t.type){let e=t.properties.find(t=>"direction"===t.name).value;t.direction=e,t.start=!0,delete t.properties,t.Object=E.addObject(t)}return new M(t)})}static calculateDistance(t,e,i,s){return Math.sqrt(Math.pow(i-t,2)+Math.pow(s-e,2))}static getInteractingWith({bound:t}){let{x:e,y:i}=t,s=null,n=1/0;return M.instances.filter(t=>"guard"===t.props.type).forEach(t=>{let{x:o,y:a}=t.col,r=M.calculateDistance(e,i,o,a);r<n&&(n=r,s=t)}),s}captureRadius({x:t,y:e,w:i,h:s}){let n=Array(1024).fill(0),o=Math.max(0,Math.floor(e/16)),a=Math.min(32,Math.ceil((e+s)/16)),r=Math.max(0,Math.floor(t/16)),l=Math.min(32,Math.ceil((t+i)/16));for(let t=o;t<a;t++)for(let e=r;e<l;e++)n[32*t+e]=1;R.setTriggers({type:"halt",value:n}),k&&(M.ctxSight.beginPath(),n.forEach((t,e)=>{0!==t&&M.ctxSight.rect(e%32*16,16*Math.floor(e/32),16,16)}),M.ctxSight.fillStyle=`${R.palette[11]}66`,M.ctxSight.fill(),M.ctxSight.closePath())}frame(){if(this.x=this.position.x,this.y=this.position.y,!this.canMove)return this.draw();this.id||(this.id=this.props.id);let t=M.chain.find(t=>t.id===this.id),e=M.chain.find(e=>e.id===t.next)||{};this.direction=t.direction,"right"===this.direction&&Object.assign(this.position,{x:this.position.x+16}),"left"===this.direction&&Object.assign(this.position,{x:this.position.x-16}),"down"===this.direction&&Object.assign(this.position,{y:this.position.y+16}),"up"===this.direction&&Object.assign(this.position,{y:this.position.y-16}),this.col={x:this.position.x-16,y:this.position.y,w:64,h:64},"camera"===this.props.type&&(this.direction=this.props.direction),e.x===this.position.x&&e.y===this.position.y&&(this.id=e.id),this.step=!this.step,this.draw()}draw(){if("camera"===this.props.type)return;let t={true:"Alt",false:""}[!this.step],e=`${this.direction}${t}`,i=M.ctx;return i.beginPath(),i.drawImage(W,this.props[e].x,this.props[e].y,this.props.width,this.props.height,this.position.x,this.position.y,this.props.width,this.props.height),i.closePath(),this.captureRadius(this.col),e}}const C=document.getElementById("sight").getContext("2d"),I=document.getElementById("vfx").getContext("2d"),B=document.getElementById("background").getContext("2d"),[k,D,O]=[!1,!1,!1],R={reset(){this.objects={},this.insideMap=[],this.collitionMap=[],this.alertTrigger=[],this.haltTrigger=[],this.timer=null,this.stepValue=0,this.hasEnergy=!0,this.found=!1,this.police=!1,this.gameOver=!1,T.instances=[],M.instances=[],E.instances=[]},Player:T,Vigilance:M,Obj:E,ticker(){10===this.stepValue&&(this.stepValue=0),this.stepValue+=1,O||c(p([["F2","C2"][this.stepValue%2]],[400])),this.timer&&clearInterval(this.timer),M.ctx.clearRect(0,0,512,512),M.ctxSight.clearRect(0,0,512,512),this.alertTrigger=Array(1024).fill(0),this.haltTrigger=Array(1024).fill(0),M.getActiveVigilance().forEach(t=>{t.frame(),this.generateSight(t)}),T.instances.forEach(t=>{let{x:e,y:i}=t.position,s=R.computePosition(e,i+16);this.testTrigger(s.collitionIndex,t)}),E.instances.filter(t=>!0===t.state).forEach(t=>{let e={x:0,y:0,w:t.width,h:t.height};t.properties.detection&&(e=t.properties.detection);let i=this.multipleComputePosition(t.x+e.x,t.y+e.y,e.w,e.h);k&&(I.beginPath(),I.strokeStyle=this.palette[4],I.rect(t.x+e.x,t.y+e.y,e.w,e.h),I.stroke(),I.closePath()),i.forEach(({collitionIndex:e})=>{this.testTrigger(e,t)})});let t=this.found?400:800,e=new Date().getTime();if(this.found&&e-this.found>5e3&&!this.police&&(g(this),this.police=!0),this.found&&e-this.found>15e3&&!this.gameOver)return this.gameOver=!0,y(this.user),clearInterval(this.timer);if(this.police){B.beginPath();let t=[R.palette[4],R.palette[3]][this.stepValue%2];B.fillStyle=t,B.rect(0,0,512,512),B.fill(),B.closePath()}this.timer=setInterval(()=>{this.ticker()},t)},triggerSight(){M.ctxSight.clearRect(0,0,512,512),M.getActiveVigilance().forEach(t=>{this.generateSight(t)})},multipleComputePosition(t,e,i,s){let n=new Set;for(let o=t;o<t+i;o+=16)for(let t=e;t<e+s;t+=16)n.add(this.computePosition(o,t));return[...n]},computePosition(t,e){let i={x:Math.floor(t/16)+2,y:Math.ceil(e/16)+2};return i.collitionIndex=i.x-1+(i.y-1)*32,i},toggleVisibility(t){let{collitionIndex:e}=this.computePosition(t.x-16,t.y-16);this.obstaclesMap[e]=t.state?0:-1,this.setSight()},generateShadow(t,e){let i=Array(1024).fill(0),s=Math.floor(t%32),n=Math.floor(t/32);for(let t=0;t<32;t++)for(let e=0;e<32;e++){let o=e-s,a=t-n,r=Math.atan2(a,o),l=Math.sqrt(o**2+a**2),h=!1;for(let t=1;t<=l;t++){let e=Math.round(s+t*Math.cos(r)),o=Math.round(n+t*Math.sin(r)),a=32*o+e;if(e>=0&&e<32&&o>=0&&o<32){if(0!==this.obstaclesMap[a]){h||(i[a]=1,h=!0);break}i[a]=1}}}C.clearRect(e.x+8,e.y+16,16,16),i.forEach((t,e)=>{0!==t&&C.clearRect(e%32*16,16*Math.floor(e/32),16,16)}),C.closePath()},generateSight(t){let e;if(t.props.Object?.state)return;let i=this.collitionMap,s=Array(1024).fill(0),[n,o]=[t.position.x,t.position.y];"guard"===t.props.type&&["down","left","up"].includes(t.direction)&&(n-=1),"right"===t.direction&&(e=[330,30]),"down"===t.direction&&(e=[60,120]),"left"===t.direction&&(e=[150,210]),"up"===t.direction&&(e=[240,300]),"camera"===t.props.type&&(["right","left"].includes(t.direction)&&(n-=1),"right"===t.direction&&(e=[0,45]),"left"===t.direction&&(e=[135,180]));let a=this.computePosition(n,o).collitionIndex,r=Math.floor(a%32),l=Math.floor(a/32);for(let t=0;t<32;t++)for(let n=0;n<32;n++){let o=n-r,a=t-l,h=Math.atan2(a,o),c=(180*h/Math.PI+360)%360;if(e[0]<=e[1]?e[0]<=c&&c<=e[1]:c>=e[0]||c<=e[1]){let t=Math.sqrt(o**2+a**2),e=!1;for(let n=1;n<=t;n++){let t=Math.round(r+n*Math.cos(h)),o=Math.round(l+n*Math.sin(h)),a=32*o+t;if(t>=0&&t<32&&o>=0&&o<32){if(0!==i[a]){e||(s[a]=1,e=!0);break}s[a]=1}}}}R.setTriggers({type:"light",value:s}),M.ctxSight.beginPath(),s.forEach((t,e)=>{0!==t&&M.ctxSight.rect(e%32*16,16*Math.floor(e/32),16,16)}),M.ctxSight.fillStyle=`${this.palette[11]}66`,M.ctxSight.fill(),M.ctxSight.closePath()},setTriggers({type:t,value:e}){"light"===t&&e.forEach((t,e)=>{t&&(this.alertTrigger[e]=t)}),"halt"===t&&e.forEach((t,e)=>{t&&(this.haltTrigger[e]=t)})},testTrigger(t,e){this.alertTrigger[t]&&!this.found&&(this.found=new Date().getTime(),d(),I.fillStyle=this.palette[1],this.displayText(e.properties.foundMessage,e),setTimeout(()=>{e.clearText()},3e3))},testHalt(t){if(this.haltTrigger[t]){let t=T.getCurrent();t.freezed=!0;let e=M.getInteractingWith(T.getCurrent());e.canMove=!1;let{x:i,y:s}=t.bound,{x:n,y:o}=e.col,a=n-i,r=o-s;Math.abs(a)>Math.abs(r)?e.direction=a>0?"left":"right":e.direction=r>0?"up":"down",this.found||(this.found=new Date().getTime(),d()),I.fillStyle=this.palette[1],this.displayText("Intruder caught!",e),setTimeout(()=>{e.clearText()},3e3)}},setSight(){if(D)return;let t=T.instances.map(({position:t})=>t);C.beginPath(),C.fillStyle=this.palette[0],C.rect(0,0,512,512),C.fill(),C.closePath(),t.forEach(t=>{this.generateShadow(this.computePosition(t.x,t.y).collitionIndex,t)})},displayText(t,e){e.clearText(),I.font='10px "Press Start 2P"',I.textAlign="center",I.fillText(t,e.x+e.width/2,e.y);let i=I.measureText(t),s=Math.ceil(i.actualBoundingBoxAscent+i.actualBoundingBoxDescent)+2;e.textBound={y:e.y-s,w:i.width,h:s,x:e.x+e.width/2-i.width/2}}};e.game=R;const j=document.getElementById("floor").getContext("2d"),F=document.getElementById("walls").getContext("2d"),G=document.getElementById("player1").getContext("2d"),K=document.getElementById("player2").getContext("2d"),V=document.getElementById("overlayer").getContext("2d"),W=new Image;let N=-1/0;const $=t=>{new Date().getTime()-N<60||(N=new Date().getTime(),q(t))},q=t=>{if(R.gameOver)return;let e=T.getCurrent();if(t===a.aKey)T.instances.forEach(t=>t.toggleActivation());else{if(e.frezed)return;switch(t){case a.leftKey:e.position.flip=!0,e.move({x:e.position.x-16});break;case a.rightKey:e.position.flip=!1,e.move({x:e.position.x+16});break;case a.upKey:e.move({y:e.position.y-16});break;case a.downKey:e.move({y:e.position.y+16});break;case a.bKey:T.getCurrent().return(),T.getCurrent().draw()}}},L=(t,e,i="data")=>{let s=t.layers.find(t=>t.name===e);return s?s[i]:[]},H=t=>{let e=(t,e,s)=>"#"+i(t)+i(e)+i(s),i=t=>{let e=t.toString(16);return 1===e.length?"0"+e:e},s=document.createElement("canvas");s.width=t.width,s.height=t.height;let n=s.getContext("2d",{willReadFrequently:!0});n.drawImage(t,0,0,t.width,t.height),R.palette=[];for(let t=4;t<=20;t+=16)for(let i=4;i<=116;i+=16){let s=n.getImageData(i,t,1,1).data,o=e(s[0],s[1],s[2]);R.palette.push(o)}},J=(t,e)=>{e.changeTrigger($),R.user=e,R.reset(),fetch(`${t}/map.json`).then(t=>t.json()).then(e=>{let i=e.properties.find(t=>"tileset"===t.name);W.onload=function(){H(W),tx();let t=L(e,"objects","objects");t.filter(t=>"player"===t.type).slice(0,2).forEach((t,e)=>{let i=0===e?G:K;T.create(i,t.x+8,t.y+16,e)}),t=t.filter(t=>"player"!==t.type),E.setPrototypes(t),R.insideMap=L(e,"floor"),R.collitionMap=L(e,"collitions"),R.obstaclesMap=L(e,"obstacles"),E.setObjects(t),M.createAll(L(e,"vigilance","objects")),T.instances.forEach(t=>t.draw()),e.layers.filter(t=>t.visible&&"tilelayer"===t.type).forEach(t=>{let e=j;"overlayer"===t.name&&(e=V),"walls"===t.name&&(e=F),t.data.forEach((t,i)=>{0!==t&&e.drawImage(W,(t-1)%8*16,16*Math.floor((t-1)/8),16,16,i%32*16,16*Math.floor(i/32),16,16)})}),R.ticker()},W.src=`${t}/${i.value}`})},_=document.getElementById("background").getContext("2d"),U=document.getElementById("floor").getContext("2d"),z=document.getElementById("light").getContext("2d");let Y=0,Q=null,Z=null;const X=t=>new Promise(t=>{let e=new Image;e.onload=function(){_.beginPath(),_.drawImage(e,0,0,1024,1024,10,10,492,492),_.rect(0,0,512,512),_.fillStyle="#000000dd",_.fill(),_.closePath(),_.beginPath(),_.rect(10,410,492,92),_.lineWidth="2",_.strokeStyle="#ffffff66",_.stroke(),_.closePath(),t()},e.src=n("hjoG2")}),tt=t=>new Promise(t=>{fetch("./levels/index.json").then(t=>t.json()).then(e=>{t(e)})});let te=null;const ti=(t=0)=>{te=!0,0===t&&(U.beginPath(),U.clearRect(0,0,512,512),U.closePath());let e=Z[t];if(!e){te=!1;return}let i=t%4,s=Math.floor(t/4),n=10+116*i+10*i,o=10+50*s+10*s;return U.beginPath(),U.rect(n,o,116,50),U.lineWidth="2",U.strokeStyle="#ffffff66",U.stroke(),U.closePath(),setTimeout(()=>{U.beginPath(),U.textAlign="center",U.fillStyle="#fff",U.font='10px "Press Start 2P"',U.fillText(e.name,n+58,o+5+25),U.closePath()},100),new Promise(e=>{setTimeout(()=>{e(ti(t+1))},200)})},ts=t=>{let e=Y%4,i=Math.floor(Y/4);z.beginPath(),z.clearRect(0,0,512,512),z.rect(10+116*e+10*e,10+50*i+10*i,116,50),z.lineWidth="2",z.strokeStyle="#ff000066",z.stroke(),z.closePath()},tn=(t,e,i,s,n,o)=>{let a=e.split(" "),r="";for(let e=0;e<a.length;e++){let l=r+a[e]+" ";t.measureText(l).width>n&&e>0?(t.fillText(r,i,s),r=a[e]+" ",s+=o):r=l}t.fillText(r,i,s)},to=t=>{let e=Z[Y];U.clearRect(10,410,492,92),ts(),setTimeout(()=>{U.beginPath(),U.textAlign="left",U.fillStyle="#fff",U.font='10px "Press Start 2P"',tn(U,e.description,20,430,482,20),U.closePath()},100)},ta=async t=>{Y=0,ts(),await ti(),to()},tr=async t=>{if(te)return;let e=Z[Y];e.levels?(Z=[{name:"<] return",description:"",path:"<goback>"},...Z[Y].levels],ta()):"<goback>"===e.path?(Z=Q,ta()):(tx(),J(`./levels/${e.path}`,t))};let tl=-1/0;const th=t=>e=>{new Date().getTime()-tl<60||(tl=new Date().getTime(),tc(e,t))},tc=(t,e)=>{switch(t){case a.rightKey:(Y+=1)===Z.length&&(Y=0),to();break;case a.leftKey:-1==(Y-=1)&&(Y=Z.length-1),to();break;case a.aKey:tr(e)}},tp=async t=>{tx(),await X(),Z=Q=await tt(),ta(),t.changeTrigger(th(t))},td=document.getElementById("background").getContext("2d");let tg=-1/0;const tu=t=>e=>{new Date().getTime()-tg<60||(tg=new Date().getTime(),tf(e,t))},tf=(t,e)=>{l(),t===a.rightKey&&tp(e)};class tm{constructor(){Object.entries(JSON.parse(localStorage.ShadowSyndicate||"{}")).forEach(([t,e])=>{this[t]=e}),this.balance||(this.balance=0),this.balance=~~this.balance}save(){localStorage.ShadowSyndicate=JSON.stringify(this)}set(t,e){this[t]=e,this.save()}push(t,e){this[t].push(e),this.save()}get(t){return this[t]}}const ty=new class{constructor(t=()=>{}){this.interval=null,this.eventsTrigger=t,document.addEventListener("keydown",({keyCode:t})=>{this.eventsTrigger(t)}),[...document.querySelectorAll(".input")].forEach(t=>{let e=t=>{this.interval=setInterval(()=>{let e=t.target.className.split(" ").filter(t=>"input"!==t)[0];this.eventsTrigger(a[`${e}Key`])},50)},i=t=>{clearInterval(this.interval)};t.addEventListener("touchstart",e),t.addEventListener("touchend",i),t.addEventListener("mousedown",e),t.addEventListener("mouseup",i)}),document.querySelector("body").addEventListener("touchend",t=>{t.preventDefault()})}changeTrigger(t){this.eventsTrigger=t}},tx=t=>{R.brain=new tm,R.brain.set("loot",[]);let e=document.getElementById("background").getContext("2d");document.querySelectorAll("canvas").forEach(t=>{t.getContext("2d").clearRect(0,0,512,512)}),e.beginPath(),e.rect(0,0,512,512),e.fillStyle="#000",e.fill(),e.closePath()};(t=>{tx();let e=new Image;e.onload=function(){td.drawImage(e,0,0,1024,1024,50,0,412,412),setTimeout(()=>{td.textAlign="right",td.fillStyle="#fff",td.strokeStyle="#000",td.font='40px "Press Start 2P"',td.fillText("Shadow",450,350),td.fillText("Syndicate",450,400),td.strokeText("Shadow",450,350),td.strokeText("Syndicate",450,400)},200)},e.src=n("axFK2"),setTimeout(()=>{td.textAlign="left",td.fillStyle="#fff",td.font='14px "Press Start 2P"',td.fillText("Press <] to start",50,450),t.changeTrigger(tu(t))},500)})(ty);
//# sourceMappingURL=index.9e6b0a88.js.map
